define("module/parentChild/vaild",["lib/tizi_ajax/0.0.1/tizi_ajax","lib/Validform/5.3.2/Validform","lib/artDialog/4.1.7/artDialog","lib/tizi_common/0.0.1/tizi_datatype","lib/tizi_common/0.0.1/tizi_validform","tizi_ajax","md5","tiziDialog","cookies","module/common/ajax/parentChild/bindAjax"],function(require,exports){require("lib/tizi_ajax/0.0.1/tizi_ajax"),require("lib/Validform/5.3.2/Validform"),require("lib/artDialog/4.1.7/artDialog");var sDataType=require("lib/tizi_common/0.0.1/tizi_datatype").dataType();exports.bindChild=function(){var _Form=$(".bindChildForm").Validform({tiptype:function(msg,o){if(!o.obj.is("form")){var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg),o.obj.next().show();var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg);var infoObj=o.obj.next(".ValidformTips");2==o.type&&(infoObj.show(),o.obj.next().hide())}},ajaxPost:!0,showAllError:!1,beforeSubmit:function(curform){require.async("tizi_validform",function(ex){ex.md5(curform)})},callback:function(data){require("lib/tizi_common/0.0.1/tizi_validform").reset_md5(".bindChildForm"),require("module/common/ajax/parentChild/bindAjax").bindSubmit(data)}});_Form.addRule([{ele:".bindChildUname",datatype:sDataType.Uname.datatype,nullmsg:sDataType.Uname.nullmsg,errormsg:sDataType.Uname.errormsg},{ele:".bindChildPasswd",datatype:sDataType.Passwd.datatype,nullmsg:sDataType.Passwd.nullmsg,errormsg:sDataType.Passwd.errormsg}])},exports.bindCreatChild=function(){var _Form=$(".creatChildForm").Validform({tiptype:function(msg,o){if(!o.obj.is("form")){var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg),o.obj.next().show();var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg);var infoObj=o.obj.next(".ValidformTips");2==o.type&&(infoObj.show(),o.obj.next().hide())}},ajaxPost:!0,showAllError:!1,beforeSubmit:function(curform){return require("lib/tizi_common/0.0.1/tizi_validform").checkCaptcha("creatChildBox",1,1)?(require("lib/tizi_common/0.0.1/tizi_validform").md5(curform),void 0):!1},callback:function(data){require("lib/tizi_common/0.0.1/tizi_validform").reset_md5(".creatChildForm"),data.errorcode||require.async("tizi_validform",function(ex){ex.changeCaptcha("creatChildBox")}),require("module/common/ajax/parentChild/bindAjax").bindSubmit(data)}});_Form.addRule([{ele:".creatChildUname",datatype:sDataType.Uname.datatype,nullmsg:sDataType.Uname.nullmsg,errormsg:sDataType.Uname.errormsg},{ele:".creatChildPasswd",datatype:sDataType.Passwd.datatype,nullmsg:sDataType.Passwd.nullmsg,errormsg:sDataType.Passwd.errormsg},{ele:".recreatChildPasswd",datatype:sDataType.Passwd.datatype,nullmsg:sDataType.Passwd.re_nullmsg,errormsg:sDataType.Passwd.re_errormsg},{ele:".creatChildURname",datatype:sDataType.URname.datatype,nullmsg:sDataType.URname.nullmsg,errormsg:sDataType.URname.errormsg},{ele:".creatGrade",datatype:"*",nullmsg:"年级不能为空",errormsg:"请选择年级"},{ele:".creatChildBoxWord",datatype:sDataType.CaptchaCode.datatype,nullmsg:sDataType.CaptchaCode.nullmsg,errormsg:sDataType.CaptchaCode.errormsg}])},exports.parLogin=function(){$(".bindChildBtn").click(function(){alert("登录")})},exports.cancelBind=function(){$(".cancelBind>a").live("click",function(){var kid=$(this).parents(".cancelBind").attr("kid"),kidname=$(this).parents(".cancelBind").attr("kidname"),fresh=!1;$.tiziDialog({title:"解除绑定",content:"确定要取消绑定<span class='cancelName'>"+kidname+"</span>的账号？",ok:function(){$.tizi_ajax({url:baseUrlName+"login/register/child_unbind",type:"POST",data:{kid:kid,ver:(new Date).valueOf()},dataType:"json",success:function(data){data.errorcode&&(fresh=!0),$.tiziDialog({title:"解除绑定",content:data.error,ok:function(){},close:function(){fresh&&window.location.reload()}})}})},cancel:!0})})}}),define("lib/tizi_common/0.0.1/tizi_datatype",[],function(require,exports){exports.dataType=function(){var _type={URname:{datatype:"*2-20",nullmsg:"请输入真实姓名",errormsg:"长度2-20个字符"},Uname:{datatype:"/^[a-zA-Z]{1}\\w{5,17}$/",nullmsg:"请输入用户名",errormsg:"以英文字母开头，6-18个英文或数字"},Stuid:{datatype:"/^\\d{8,10}$/",nullmsg:"请输入学号",errormsg:"长度8-10个数字"},Username:{datatype:"e | *6-20",nullmsg:"请输入邮箱/手机号/用户名/学号",errormsg:"长度6-20个字符"},Email:{datatype:"e",nullmsg:"请输入邮箱地址",errormsg:"请输入正确的邮箱地址"},Phone:{datatype:"m",nullmsg:"请输入手机号码",errormsg:"请输入正确的手机号码"},PhoneCode:{datatype:"/^\\d{6}$/",datatype_allownull:"/^\\d{6}$/ | /^\\w{0}$/",nullmsg:"请输入验证码",errormsg:"验证码长度是6位"},CaptchaCode:{datatype:"/^\\w{4}$/",nullmsg:"请输入验证码",errormsg:"验证码长度是4位"},QQ:{datatype:"n5-12 | /^\\w{0}$/",datatype_nonull:"n5-12",nullmsg:"请输入QQ号码！",errormsg:"长度5-12个数字"},Passwd:{datatype:"*6-16",nullmsg:"请输入密码",errormsg:"长度6-16个字符之间",old_nullmsg:"请输入旧密码",re_nullmsg:"请再次输入密码",re_errormsg:"两次密码不一致！",new_nullmsg:"请输入新密码",re_new_nullmsg:"请再次输入新密码"},Dname:{datatype:"/^[a-zA-Z]{1}[a-zA-Z_0-9]{3,17}$/",nullmsg:"请输入个性域名",errormsg:"以英文字母开头，4-18个英文，数字或下划线"},Oname:{datatype:"*2-20",nullmsg:"请输入单位名称",errormsg:"长度2-20个字符"},Classname:{datatype:"*1-12",nullmsg:"请输入班级名称",errormsg:"长度1-12个字符"},Classnum:{datatype:"*6-8",nullmsg:"请输入班级编号",errormsg:"长度6-8个字符"},radioValid:{datatype:"*"}};return _type}}),define("lib/tizi_common/0.0.1/tizi_validform",["lib/tizi_ajax/0.0.1/tizi_ajax","lib/md5/0.0.1/md5","lib/artDialog/4.1.7/artDialog","lib/cookies/0.0.1/jquery.cookies"],function(require,exports){require("lib/tizi_ajax/0.0.1/tizi_ajax"),exports.md5=function(element){require("lib/md5/0.0.1/md5");var i=0;element.find("input").each(function(){if("password"==$(this).attr("type")){var input_name=$(this).attr("name");void 0==input_name&&(input_name=$(this).attr("md5_name")),input_name&&(i+=1);var input_id=input_name+i,pass_hidden='<input class="text-input" id="'+input_id+'_md5" name="'+input_name+'" type="hidden">';$("#"+input_id+"_md5").remove(),$(this).parent().append(pass_hidden),$("#"+input_id+"_md5").val(tizi_md5($(this).val())),$(this).attr("md5_name",input_name).removeAttr("name")}})},exports.reset_md5=function(element){var i=0;$(element).find("input").each(function(){if("password"==$(this).attr("type")){input_name=$(this).attr("md5_name"),input_name&&(i+=1);var input_id=input_name+i;$("#"+input_id+"_md5").remove(),$(this).attr("name",input_name).removeAttr("md5_name")}})},exports.changeCaptcha=function(captcha_name){if(void 0==captcha_name)return!1;var img=$("."+captcha_name).siblings("img"),type=((new Date).valueOf(),"base64");$.browser.msie&&"6.0"==$.browser.version&&(type="normal"),$.tizi_ajax({url:baseUrlName+"captcha",type:"get",dataType:"json",data:{captcha_name:captcha_name,captcha_type:type,ver:(new Date).valueOf()},success:function(data){data.errorcode?(img.attr("src",data.image),data.word?($("."+captcha_name).parent().addClass("undis"),$("."+captcha_name+"Word").val(data.word)):$("."+captcha_name).parent().removeClass("undis")):require.async("tiziDialog",function(){$.tiziDialog({icon:"error",content:data.error,time:3})})}})},exports.bindChangeVerify=function(captcha_name){$(".commonCaptcha").find("."+captcha_name)&&$("."+captcha_name).siblings(".changeCaptcha").each(function(){$(this).live("click",function(event){event.preventDefault(),exports.changeCaptcha(captcha_name)})})},exports.checkCaptcha=function(captcha_name,keep_code,show_dialog,checkcode){var check=!1;return void 0==captcha_name&&(captcha_name=basePageName),void 0==checkcode&&(checkcode=$("."+captcha_name+"Word").val()),void 0==keep_code&&(keep_code=1),$.tizi_ajax({url:baseUrlName+"check_captcha",type:"get",dataType:"json",async:!1,data:{check_code:checkcode,keep_code:keep_code,captcha_name:captcha_name,ver:(new Date).valueOf()},success:function(data){data.errorcode?($(".textCaptcha").siblings(".Validform_checktip").text(data.error).attr("class","Validform_checktip Validform_right"),check=!0):(show_dialog&&require.async("tiziDialog",function(){$.tiziDialog({icon:"error",content:data.error,time:3})}),$(".commonCaptcha .Validform_checktip").text(data.error).attr("class","Validform_checktip Validform_wrong"),$("."+captcha_name).parent().hasClass("undis")&&($("."+captcha_name+"Word").val(""),exports.changeCaptcha(captcha_name)),check=!1)}}),check},exports.sendPhoneCode=function(phone,code_type,fn,errfn){var url=baseUrlName+"send_phone_code";require("lib/artDialog/4.1.7/artDialog"),$.tizi_ajax({url:url,type:"post",dataType:"json",data:{phone:phone,code_type:code_type,ver:(new Date).valueOf()},success:function(data){data.errorcode?fn(data):errfn(data)}})},exports.sendEmailCode=function(email,code_type,fn,errfn){var url=baseUrlName+"send_email_code";$.tizi_ajax({url:url,type:"post",dataType:"json",data:{email:email,code_type:code_type,ver:(new Date).valueOf()},success:function(data){data.errorcode?fn():errfn(data)}})},exports.checkPhoneCode=function(checkcode,phone,code_type){var url=baseUrlName+"check_code",check=!1;return require("lib/tizi_ajax/0.0.1/tizi_ajax"),$.tizi_ajax({url:url,type:"post",dataType:"json",async:!1,data:{phone:phone,check_code:checkcode,code_type:code_type,ver:(new Date).valueOf()},success:function(data){data.errorcode?($(".phoneCode").siblings(".Validform_checktip").text(data.error).attr("class","Validform_checktip Validform_right"),check=!0):($(".phoneCode").siblings(".Validform_checktip").text(data.error).attr("class","Validform_checktip Validform_wrong"),check=!1)}}),check},exports.detectFlashSupport=function(fn_noflash,fn_flash){void 0==fn_noflash&&(fn_noflash=function(){}),void 0==fn_flash&&(fn_flash=function(){});var hasFlash=!1;if("function"==typeof ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(hasFlash=!0)}catch(error){}!hasFlash&&navigator.mimeTypes["application/x-shockwave-flash"]&&(hasFlash=!0),hasFlash?fn_flash():fn_noflash()},exports.checkLogin=function(){require("lib/cookies/0.0.1/jquery.cookies");var username=$.cookies.get(baseUnID);username&&$.tizi_ajax({url:baseUrlName+"login/login/check_login",type:"get",dataType:"json",data:{},success:function(data){data.errorcode&&(window.location.href=baseUrlName)}})}}),define("module/common/ajax/parentChild/bindAjax",["lib/artDialog/4.1.7/artDialog"],function(require,exports){require("lib/artDialog/4.1.7/artDialog"),exports.bindSubmit=function(data){data.errorcode?data.redirect&&(window.location.href=data.redirect):$.tiziDialog({content:data.error})}});