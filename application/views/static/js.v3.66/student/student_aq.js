var StudentCommon={};StudentCommon.memberCenter={leftLiHover:function(json){var _li=json.li,_hover=json.hover;$(_li).each(function(){$(this).hover(function(){$(this).addClass(_hover)},function(){$(this).removeClass(_hover)})})},tabChange:function(json){var _id=json.id,_on=json.on,_con=json.con,_dis=json.dis;$(_id).click(function(){$(this).addClass(_on).siblings().removeClass(_on);var index=$(_id).index(this);$(_con).eq(index).addClass(_dis).siblings().removeClass(_dis)})},openDiv:function(json){var cancle=$(json.cancle),cen_win=$(json.cen_win),layer=$(json.layer),infor=($(json.inner),$(json.Body),$(json.infor));$(".enter").click(function(){window.location.href="dohomework.html"}),$(".yes").live("click",function(){layer.hide(),cen_win.hide()}),cancle.unbind().die().live("click",function(){cen_win.hide(),layer.hide()}),$(".win_box .no").live("click",function(){var _val=$("#sex").val();layer.hide(),cen_win.hide(),infor.find("li").eq("2").children("strong").html(_val)}),$(".over").each(function(){$(this).click(function(){var _scrollTop=$(window).scrollTop();$(".center_window").css("top",_scrollTop+250+"px"),cen_win.show(),layer.show()})}),$(".center_layer").height($(document).height())}};var Student={};Student.onlineQa={init:function(){this.aq_subject(),this.get_grades(),this.dosubmit(),this.uploadImages(),this.initUploadImages()},dosubmit:function(){var str_tip=['<div class="md_qreason_tip">请输入该问题的详细描述。<em onclick="Student.aq_ask.close_event(this)">X</em></div>','<div class="md_qreason_tip">请选择问题原因。<em onclick="Student.aq_ask.close_event(this)">X</em></div>','<div class="md_qreason_tip">请选择学科。<em onclick="Student.aq_ask.close_event(this)">X</em></div>','<div class="md_qreason_tip">请选择年级分类。<em onclick="Student.aq_ask.close_event(this)">X</em></div>'];$("#content").blur(function(){$(".md_qreason_tip").remove(),$("#submitQuestion").removeClass().addClass("submitQuestion")}),$(".submitQuestion").live("click",function(){var id=$("#aq_question_id").val(),content=$("#content").html(),picture_urls="";$(".picture_urls").each(function(){picture_urls+=""===picture_urls?"":",",picture_urls+=$(this).attr("src")});var type=$('input[name="aq_question_type"]:checked').val(),grade=$("#grade_id").val(),point_ids="",subject_id=$("#subject_id").val();$('input[name="sub_item"]:checked').each(function(){point_ids+=""===point_ids?"":",",point_ids+=$(this).val()});var reward=$("#reward").val(),flag=!1,is_teacher=$("#is_teacher").val();if((""!==$.trim(content)||$(".picture_urls").length>-1)&&($("#submitQuestion").removeClass().addClass("submitQuestionGray"),$(".submitQuestion").attr("disabled",!0)),""==subject_id?($(".learn_branch").after(str_tip[2]),$(".submitQuestion").attr("disabled",!0)):""==grade&&($(".learn_branch").after(str_tip[3]),$(".submitQuestion").attr("disabled",!0)),(""!==$.trim(content)||$(".picture_urls").length>-1)&&""!=grade&&($("#submitQuestion").removeClass().addClass("submitQuestion"),$(".submitQuestion").removeAttr("disabled"),flag=!0),flag){if(id>0)if(is_teacher)var request_uri="/teacher/aq_teacher/send_edit";else var request_uri=baseUrlName+"student/aq_controller/edit";else var request_uri=baseUrlName+"student/aq_controller/ask";$.tizi_ajax({url:request_uri,type:"POST",dataType:"json",data:{specific:$("#specific").val(),teacher_id:$("#teacher_id").val(),content:content,picture_urls:picture_urls,type:type,subject_id:subject_id,grade:grade,point_ids:point_ids,reward:reward,question_id:id>0?id:0},success:function(json){$("#ask_page").length>0?0==json.errorcode?($.tiziDialog({content:json.error}),window.location.href=window.location.href):($.tiziDialog({content:"提交成功"}),window.location.href="/student/question/detail/"+json.error):1==json.errorcode?($.tiziDialog({icon:"succeed",content:"修改成功！",time:1}),window.location.href="/student/question/detail/"+id):($.tiziDialog({content:"修改失败",icon:"warning"}),window.location.href=window.location.href)},error:function(){$.tiziDialog({content:"系统繁忙，请稍后再试",icon:"error"})}})}})},aq_subject:function(){$.ajax({url:baseUrlName+"student/aq_start/subject",type:"GET",dataType:"json",success:function(json){for(var options='<option value="0">请选择科目</option>',i=0;i<json.length;++i)options+='<option value="'+json[i].aq_subject_id+'">'+json[i].aq_subject_name+"</option>";$("#aq_subject").html(options),$("#aq_subject").css("display","")}})},get_grades:function(){$("#aq_subject").live("change",function(){var subject_id=$(this).val();subject_id>0&&$("#aq_subject option[value='0']").attr("disabled","disabled"),$.ajax({url:baseUrlName+"student/aq_start/grade?subject_id="+subject_id,type:"GET",dataType:"json",success:function(json){for(var options='<option value="0">请选择年级</option>',i=0;i<json.length;++i)options+='<option value="'+json[i].aq_grade_id+'">'+json[i].aq_grade_name+"</option>";$("#aq_grades").html(options),$("#aq_grades").css("display","")}})}),$("#aq_grades").live("change",function(){var grade_id=$(this).val();grade_id>0&&$("#aq_grades option[value='0']").attr("disabled","disabled")})},uploadImages:function(){var that=this;$(".aqupload").each(function(){var node=$(this),loading=staticUrlName+"image/answerquestion/loading.gif",upload_id=node.attr("id");$("#"+upload_id).uploadify({formData:$.tizi_token({session_id:$.cookies.get(baseSessID)},"post"),swf:staticBaseUrlName+staticVersion+"lib/uploadify/2.2/uploadify.swf",uploader:baseUrlName+"upload/aqask?id="+upload_id,multi:!1,buttonClass:"choseFileBtn",buttonText:"上传图片",fileTypeExts:"*.jpg; *.png;*.gif",fileSizeLimit:"2048KB",fileObjName:upload_id,width:102,height:28,overrideEvents:["onSelectError","onDialogClose"],onUploadStart:function(){$("."+upload_id).html('<img src="'+loading+'" class="imgloading"/>')},onSWFReady:function(){},onFallback:function(){$(".imgTips").html(noflash)},onSelectError:function(file,errorCode){switch(errorCode){case-110:$.tiziDialog({content:"文件 ["+file.name+"] 过大！每张图片不能超过2M"});break;case-120:$.tiziDialog({content:"文件 ["+file.name+"] 大小异常！不可以上传大小为0的文件"});break;case-130:$.tiziDialog({content:"文件 ["+file.name+"] 类型不正确！不可以上传错误的文件格式"})}return!1},onUploadSuccess:function(file,data){var json=JSON.parse(data);if(1==json.code){var img_path=json.img_path;that.drawImage(img_path,92,71,upload_id),$("."+upload_id).removeClass("red"),$("."+upload_id).addClass("upladpicSpan").removeClass("upladpic")}else $("."+upload_id).html("<b>"+json.msg+"</b>"),$("."+upload_id).addClass("red");$("."+upload_id).siblings(".clearpic").show(),$("."+upload_id).siblings(".clearpic").on("click",function(){$("."+upload_id).find("img").remove(),$("."+upload_id).siblings(".clearpic").hide(),$("."+upload_id).removeClass("red"),$("."+upload_id).removeClass("upladpicSpan").addClass("upladpic")})},onUploadComplete:function(){}})})},drawImage:function(src,width,height,upload_id){var image=new Image,Img=new Image;image.src=src,image.onload=function(){image.width>width||image.height>height?(w=image.width/width,h=image.height/height,w>h?(Img.width=width,Img.height=image.height/w):(Img.height=height,Img.width=image.width/h)):(h=image.height/height,Img.width=image.width/h,Img.height=height),$("."+upload_id).html('<img src="'+src+'" class="picture_urls" width="'+Img.width+'" height="'+Img.height+'"/>')}},initUploadImages:function(){var upladpic=$(".upladpic");upladpic.each(function(){var that=$(this),pics=$(this).find("img");1==pics.length&&(that.removeClass("upladpic").addClass("upladpicSpan"),that.siblings(".clearpic").show(),that.siblings(".clearpic").on("click",function(){that.find("img").remove(),$(this).hide(),that.removeClass("red"),that.removeClass("upladpicSpan").addClass("upladpic")}))})}},Student.answerQuestion={aq_controller_view_teacher:baseUrlName+"student/aq/teacher/",aq_controller_question_detail:baseUrlName+"student/question/detail/",aq_controller_lists:baseUrlName+"student/my_question/list/",aq_controller_add_comment:baseUrlName+"student/aq_controller/add_comment",aqIndexHover:function(obj,con){$(obj).hover(function(){$(obj).css("z-index","10");var index=$(obj).index(this);$(obj).eq(index).css("z-index","50"),$(con).css("z-index","1").hide(),$(con).eq(index).css("z-index","100").show(),(index%4==3||index%4==2)&&$(con).eq(index).css("left","-240px")},function(){$(con).hide()})},hoverStar:function(){function fnPoint(iArg){for(iScore=iArg||iStar,i=0;i<aLi.length;i++)aLi[i].className=iScore>i?"on":""}var aLi=($("#star"),$("#star li")),oSpan=($("#star ul").first(),$("#star em").first()),i=iScore=iStar=0,aMsg=["很不满意","不满意","一般","满意","非常满意"];aLi.addClass("on");var flag_str="";for($("#evaluate_stars").val("5"),i=1;i<=aLi.length;i++)aLi[i-1].index=i,aLi[i-1].onmouseover=function(){fnPoint(this.index),oSpan.html(aMsg[this.index-1]),$("#star").mouseleave(function(){if(""!=flag_str){for(var i=Number(flag_str);i>=0;i--)aLi.eq(i).addClass("on");oSpan.html(aMsg[Number(flag_str)])}})},aLi[i-1].onclick=function(){iStar=this.index,$("#evaluate_stars").val(iStar),oSpan.html(aMsg[this.index-1]),flag_str=this.index-1,$("#star").off("mouseleave")}},view_teacher_cmt_ajax:function(offset){urls=this.aq_controller_view_teacher+$("#teacher_id").val()+"?ver="+(new Date).valueOf(),(""==offset||null==offset||void 0==offset)&&(offset=""),content="",$.ajax({type:"GET",dataType:"text",url:urls,async:!1,data:{rf_cmt:!0,offset:offset},success:function(data){content=data,""!=data&&$(".aQuestionComment").html(content)}})},view_teacher_question_ajax:function(offset){urls=this.aq_controller_view_teacher+$("#teacher_id").val()+"?ver="+(new Date).valueOf(),(""==offset||null==offset||void 0==offset)&&(offset=""),content="",$.ajax({type:"GET",dataType:"text",url:urls,async:!1,data:{rf_q:!0,offset:offset},success:function(data){content=data,""!=data&&$(".aQuestionCon").html(content)}})},my_question_list_pagination_ajax:function(offset){urls=this.aq_controller_lists+"?ver="+(new Date).valueOf(),(""==offset||null==offset||void 0==offset)&&(offset=""),content="",$.ajax({type:"GET",dataType:"text",url:urls,async:!1,data:{rf:!0,page:offset},success:function(data){content=data,""!=data&&$(".myAskList").html(content)}})},myAskListHover:function(){$(".myAskList li").hover(function(){$(this).addClass("on").css("cursor","pointer").siblings().removeClass("on")},function(){$(this).removeClass("on")}),$(".myAskList li").click(function(){window.location.href=$(this).find(".con").attr("liUrl")})},aQuestionConHover:function(){$(".aQuestionCon li").hover(function(){var _href=$(this).find("a").attr("href");void 0!==_href&&$(this).addClass("on").css("cursor","pointer").siblings().removeClass("on")},function(){$(this).removeClass("on")}),$(".aQuestionCon li").click(function(){var _href=$(this).find(".ico_voiceResponse").attr("href");return void 0!==_href?(window.open($(this).find(".ico_voiceResponse").attr("href")),!1):void 0})},imgMaxWidth:function(id){$(id).each(function(){$(this).width()>770&&$(this).css("width","770px")})},question_detail_give_cmt:function(){$("#submitOk").click(function(){$("#submitOk").attr("disabled",!0),$.tizi_ajax({url:baseUrlName+"student/aq_controller/add_comment",type:"POST",dataType:"json",data:{question_id:$("#this_question_id").val(),teacher_id:$("#this_teacher_id").val(),evaluate:$("#evaluate_stars").val(),content:$("#student_evaluate_content").val()},success:function(res){if(res.errorcode)window.location.reload();else{$.tiziDialog({content:res.error});var _thistop=document.body.scrollTop+document.documentElement.scrollTop+($(window).height()-$("#tizi_dialogs").height())/2;$("#tizi_dialogs").css("top",_thistop),$("#submitOk").attr("disabled",!1)}},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"}),$("#submitOk").attr("disabled",!1)}})})},liteAreaAlert:function(){var text="描述问题，一次只能问一个题哦";$(".lite_area").live("focus",function(){$(this).text()==text&&$(this).text("")}),$(".lite_area").live("blur",function(){""==$(this).text()&&$(this).text(text)})}},Student.aq_ask={init:function(){this.upload_event(),this.upload_init()},upload_event:function(){$(".aqupload").live("change",function(){var node=$(this);node.prev().attr("src",staticUrlName+"image/answerquestion/loading.gif");var upload_id=node.attr("id");$.ajaxFileUpload({url:baseUrlName+"student/aq_ask/upload?id="+upload_id,secureuri:!1,fileElementId:upload_id,dataType:"json",data:{id:upload_id},success:function(){$(".md_qreason_tip").remove()},error:function(data,status,e){var responseHtml=data.responseText,newjson=eval("("+responseHtml+")");1==newjson.code?($("."+upload_id).removeClass("red"),$("."+upload_id).html('<img src="'+newjson.img_path+'" class="picture_urls"/>')):($("."+upload_id).html("<b>"+newjson.msg+"</b>"),$("."+upload_id).addClass("red")),$("."+upload_id).siblings(".clearpic").show(),$("."+upload_id).siblings(".clearpic").on("click",function(){$("."+upload_id).html("<b>暂无图片</b>"),$("."+upload_id).siblings(".clearpic").hide(),$("."+upload_id).removeClass("red")})}})})},close_event:function(obj){var obj=$(obj);obj.parent().remove(),$("#submitQuestion").removeClass().addClass("submitQuestion")},upload_init:function(){var picture_urls=$(".picture_urls");picture_urls.length>-1&&(picture_urls.parent().siblings(".clearpic").show(),picture_urls.parent().siblings(".clearpic").on("click",function(){$(this).siblings(".upladpic").html("<b>暂无图片</b>"),$(this).hide()}))}};