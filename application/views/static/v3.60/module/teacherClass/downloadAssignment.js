define("module/teacherClass/downloadAssignment",["lib/tizi_ajax/0.0.1/tizi_ajax","lib/artDialog/4.1.7/artDialog","lib/tizi_common/0.0.1/tizi_download","cookies","tizi_ajax","tiziDialog"],function(require,exports){require("lib/tizi_ajax/0.0.1/tizi_ajax"),require("lib/artDialog/4.1.7/artDialog"),exports.homeworkDownload={downWord:$(".down-word-btn"),init:function(){var _this=this;$(".downhw").click(function(){_this._downhw($(this).attr("assid"),"student")}),$(".teacherdownhw").click(function(){_this._downhw($(this).attr("assid"),"teacher")})},_downhw:function(slid,role){if("disabled"==this.downWord.attr("disabled"))return!1;var _icon="",content="是否确定下载本次作业？",width=360;_icon="question",$.tiziDialog({title:"下载作业",content:content,icon:_icon,width:width,init:function(){$(".paperCaptchaWord").addClass("undis")},ok:function(){this_a=exports.homeworkDownload;var downWord=$("a[slid='"+slid+"'][class='down-word-btn']");downWord.html("下载中"),downWord.attr("disabled","disabled"),this_a.hw_download(slid,role,"homework",function(){this_a=exports.homeworkDownload,downWord.html("下载"),downWord.removeAttr("disabled")}),"student"==role&&$.tizi_ajax({url:baseUrlName+"student/task/download_hw_mark",type:"POST",data:{assid:slid},dataType:"json",success:function(data){return data.errorcode}})},cancel:!0})},hw_download:function(slid,role,download_type,unlock){var paper_version="docx",paper_type=role,post_data={paper_version:paper_version,paper_type:paper_type,save_log_id:slid,download_type:download_type,assid:slid},paper_size="A4";post_data.captcha_name="PaperDownBox",post_data.captcha_word=$(".PaperDownBoxWord").val(),post_data.paper_style="default",post_data.paper_size=paper_size,baseuri=baseUrlName+"paper/download/down_assignment",$.tizi_ajax({url:baseuri,type:"POST",data:post_data,dataType:"json",success:function(data){if(unlock(),0==data.errorcode)$.tiziDialog({content:data.error});else{var url=baseUrlName+"download/paper?url="+data.url+"&file_name="+data.file_name+"&download_type="+download_type;ga("send","event","Download-Paper-"+download_type,"Download",data.fname),require("lib/tizi_common/0.0.1/tizi_download").force_download(url,data.fname)}}})}}}),define("lib/tizi_common/0.0.1/tizi_download",["lib/cookies/0.0.1/jquery.cookies","lib/tizi_ajax/0.0.1/tizi_ajax","lib/artDialog/4.1.7/artDialog"],function(require,exports){require("lib/cookies/0.0.1/jquery.cookies"),require("lib/tizi_ajax/0.0.1/tizi_ajax"),require("lib/artDialog/4.1.7/artDialog"),exports.force_download=function(url,fname,openbox,noxunlei){noxunlei||(url=url+"&session_id="+$.cookies.get(baseSessID));var ie_ver=exports.ie_version();return 1==openbox||6==ie_ver||7==ie_ver||8==ie_ver?(fname=""==fname||void 0==fname?"请点击下载":"请点击下载《"+fname+"》",$.tiziDialog({content:fname,ok:!1,cancel:!1,dblclick:!1,icon:null,button:[{name:"点击下载",href:url,className:"aui_state_highlight",target:"_self"}]}),!1):(window.location.href=url,void 0)},exports.ie_version=function(){var ie=$.browser.msie,version=$.browser.version;return ie?version:!1},exports.down_confirm_box=function(url,fname){$.tiziDialog({content:"是否下载文件《"+fname+"》？",ok:!1,cancel:!0,icon:null,button:[{name:"点击下载",href:url,className:"aui_state_highlight",target:"_self"}]})}});