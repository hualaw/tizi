define("module/teacherPaper/paperDownload",["lib/tizi_ajax/0.0.1/tizi_ajax","lib/artDialog/4.1.7/artDialog","lib/tizi_common/0.0.1/tizi_validform","tizi_ajax","md5","tiziDialog","cookies","lib/tizi_common/0.0.1/tizi_download"],function(require,exports){require("lib/tizi_ajax/0.0.1/tizi_ajax"),require("lib/artDialog/4.1.7/artDialog"),exports.paperDownload={downWord:$(".down-word-btn"),downCard:$(".down-card-btn"),init:function(){var _this=this;$(".down-word-btn").click(function(){_this.open_downword($(this).attr("slid"))}),$(".down-card-btn").click(function(){_this.open_downcard($(this).attr("slid"))}),$(".del-log-btn").click(function(){var slid=$(this).attr("slid"),page=$(".page").find(".active").html(),type=$("#filter_type").attr("data_type");$.tiziDialog({content:"确定删除当前文档？",cancel:!0,ok:function(){seajs.use("module/teacherPaper/paperArchive",function(ex){ex.paperArchive.delete_log(page,type,slid)})}})})},open_downword:function(slid){return"disabled"==this.downWord.attr("disabled")?!1:($.tiziDialog({title:"下载试卷",content:$("#down-paper-content").html().replace("downWin_tpl","downWin").replace("PaperDownBox_tpl","PaperDownBox").replace("PaperDownBoxWord_tpl","PaperDownBoxWord"),icon:null,width:787,init:function(){require("lib/tizi_common/0.0.1/tizi_validform").changeCaptcha("PaperDownBox"),require("lib/tizi_common/0.0.1/tizi_validform").bindChangeVerify("PaperDownBox")},okVal:"立即下载本试卷",ok:function(){var checkcode=require("lib/tizi_common/0.0.1/tizi_validform").checkCaptcha("PaperDownBox",1,1);if(!checkcode)return!1;this_a=exports.paperDownload;var downWord=$("a[slid='"+slid+"'][class='down-word-btn']");downWord.html("下载中"),downWord.attr("disabled","disabled"),this_a.download(slid,"paper",function(){this_a=exports.paperDownload,downWord.html("下载"),downWord.removeAttr("disabled")})},cancel:!0}),$(".teacherPaper p.in").hover(function(){$(".teacherPaper p.in").removeClass("active"),$(this).addClass("active").siblings().removeClass("active")},function(){$(".teacherPaper p.in").removeClass("active")}).click(function(){$(this).find("input").addClass("windInput").attr("checked","checked")}),void 0)},open_downcard:function(slid){return"disabled"==this.downCard.attr("disabled")?!1:($.tiziDialog({title:"下载答题卡",content:$("#down-card-content").html().replace("downWin_tpl","downWin"),icon:null,width:787,ok:function(){this_a=exports.paperDownload;var downCard=$("a[slid='"+slid+"'][class='down-card-btn']");downCard.html("下载中"),downCard.attr("disabled","disabled"),this_a.download(slid,"card",function(){this_a=exports.paperDownload,downCard.html("答题卡"),downCard.removeAttr("disabled")})},cancel:!0}),void 0)},setDownloadChecked:function(download_type,name,value){for(var len=$("#down-"+download_type+"-content").find("input[type=radio][name="+download_type+"_"+name+"]").length,i=0;len>i;i++){var obj=$("#down-"+download_type+"-content").find("input[type=radio][name="+download_type+"_"+name+"]").eq(i);obj.val()==value?obj.attr("checked",!0):obj.attr("checked",!1)}},download:function(slid,download_type,unlock){var paper_version=$(".downWin").find("input[type=radio][name="+download_type+"_version]:checked").val();this.setDownloadChecked(download_type,"version",paper_version);var paper_type=$(".downWin").find("input[type=radio][name="+download_type+"_type]:checked").val();this.setDownloadChecked(download_type,"type",paper_type);var post_data={paper_version:paper_version,paper_type:paper_type,save_log_id:slid,download_type:download_type};if("paper"==download_type){var paper_size=$(".downWin").find("input[type=radio][name=paper_size]:checked").val();this.setDownloadChecked(download_type,"size",paper_size),post_data.captcha_name="PaperDownBox",post_data.captcha_word=$(".PaperDownBoxWord").val(),post_data.paper_style="default",post_data.paper_size=paper_size,baseuri=baseUrlName+"paper/download/paper"}"card"==download_type&&(baseuri=baseUrlName+"paper/download/card"),$.tizi_ajax({url:baseuri,type:"POST",data:post_data,dataType:"json",success:function(data){if(unlock(),0==data.errorcode)$.tiziDialog({content:data.error});else{var url=baseUrlName+"download/paper?url="+data.url+"&file_name="+data.file_name+"&download_type="+download_type;ga("send","event","Download-Paper-"+download_type,"Download",data.fname),require("lib/tizi_common/0.0.1/tizi_download").force_download(url,data.fname)}}})}}});