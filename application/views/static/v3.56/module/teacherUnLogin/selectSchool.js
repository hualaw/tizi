define("module/teacherUnLogin/selectSchool",["module/common/basics/teacherUnLogin/valid","tizi_ajax","validForm","module/teacherUnLogin/unLoginArtDialog","tiziDialog","module/teacherUnLogin/teacherClass","module/common/basics/teacherClass/classValid","module/common/ajax/teacherClass/classAjax","module/common/method/common/tab"],function(require){var _valid=require("module/common/basics/teacherUnLogin/valid");_valid.teacherClassNum_add(),_valid.teacherClassNum_have();var _art=require("module/teacherUnLogin/unLoginArtDialog");_art.shareWord();var _class=require("module/teacherUnLogin/teacherClass");_class.classManageDialog()}),define("module/common/basics/teacherUnLogin/valid",["lib/tizi_ajax/0.0.1/tizi_ajax","lib/Validform/5.3.2/Validform"],function(require,exports){require("lib/tizi_ajax/0.0.1/tizi_ajax"),require("lib/Validform/5.3.2/Validform"),exports.teacherClassNum_add=function(){alert(1);var _Form=$(".addClassNumForm").Validform({tiptype:3,showAllError:!1,beforeSubmit:function(){},ajaxPost:!0,callback:function(data){require.async("module/common/ajax/teacherClass/classAjax",function(ex){ex.common(data)})}});_Form.addRule([{ele:"#set_year",datatype:"*",nullmsg:"请选择年份",errormsg:"选择错误！"},{ele:"#schoolVal",datatype:"*",nullmsg:"请选择学校",errormsg:"选择错误！"},{ele:".classNameInput",datatype:"*1-12",nullmsg:"请输入班级名称",errormsg:"长度1-12个字符"},{ele:".classNumInput",datatype:"*6-8",nullmsg:"请输入班级编号",errormsg:"长度6-8个字符"},{ele:".subjectInput",datatype:"*",nullmsg:"请选择学科",errormsg:"未选择学科"}])},exports.teacherClassNum_have=function(){var _Form=$(".haveClassNumForm").Validform({tiptype:3,showAllError:!1,beforeSubmit:function(){},ajaxPost:!0,callback:function(data){require.async("module/common/ajax/teacherClass/classAjax",function(ex){ex.common(data)})}});_Form.addRule([{ele:".classNumInput",datatype:"*6-8",nullmsg:"请输入班级编号",errormsg:"长度6-8个字符"},{ele:".subjectInput",datatype:"*",nullmsg:"请选择学科",errormsg:"未选择学科"}])}}),define("module/teacherUnLogin/unLoginArtDialog",["lib/artDialog/4.1.7/artDialog","lib/Validform/5.3.2/Validform","lib/tizi_ajax/0.0.1/tizi_ajax"],function(require,exports){require("lib/artDialog/4.1.7/artDialog"),require("lib/Validform/5.3.2/Validform"),require("lib/tizi_ajax/0.0.1/tizi_ajax"),exports.shareWord=function(){$(".newAddClassBtn").click(function(){$.tiziDialog({title:"分享文档",content:$(".artShareWodrBox").html(),icon:null,width:600,ok:!1})})}}),define("module/teacherUnLogin/teacherClass",["lib/artDialog/4.1.7/artDialog","lib/Validform/5.3.2/Validform","lib/tizi_ajax/0.0.1/tizi_ajax","module/common/basics/teacherClass/classValid","tizi_datatype","module/common/ajax/teacherClass/classAjax","module/common/basics/common/md5","module/common/basics/common/showLogin","module/common/method/common/tab"],function(require,exports){require("lib/artDialog/4.1.7/artDialog"),require("lib/Validform/5.3.2/Validform"),require("lib/tizi_ajax/0.0.1/tizi_ajax");var classValid=require("module/common/basics/teacherClass/classValid"),classAjax=require("module/common/ajax/teacherClass/classAjax"),tabContral=require("module/common/method/common/tab");exports.classManageDialog=function(){$(".subject_me").live("change",function(){var subject_id=$(this).val(),class_id=$(this).attr("class_id");$.tizi_ajax({url:baseUrlName+"class/update_info/class_subject",type:"POST",dataType:"json",data:{subject_id:subject_id,class_id:class_id},success:function(json){1==json.code?$.tiziDialog({content:json.msg,icon:"succeed"}):-999==json.code?showLogin.show_login():$.tiziDialog({content:json.msg})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})}),$(".addNewClass").live("click",function(){$.ajax({url:baseUrlName+"class/create/ms",type:"GET",dataType:"json",success:function(json){json.subject_type>0&&$("#teacher_subject").val(json.subject_type)}}),$.tiziDialog({title:"添加新班级",content:$("#inVislbleClass").html().replace("inVislbleClassForm_beta","inVislbleClassForm").replace("creatNewClassForm_beta","creatNewClassForm"),icon:null,width:600,ok:!1}),classValid.invite(),classValid.creat()}),$(".quitClass").live("click",function(){var classname=($(this),$(this).attr("name")),class_id=$(this).attr("data-id");$.tiziDialog({title:"退出班级",content:$("#quitClassPop").html().replace("%classname%",classname),icon:null,width:400,ok:function(){$.tizi_ajax({url:baseUrlName+"class/leave/teacher",type:"POST",dataType:"json",data:{class_id:class_id},success:function(json){1==json.code?$.tiziDialog({content:json.msg,icon:"succeed",ok:function(){window.location.reload()}}):-999==json.code?showLogin.show_login():$.tiziDialog({content:json.msg})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})},cancel:!0})}),$(".deleteClass").live("click",function(){var classname=($(this),$(this).attr("name")),class_id=$(this).attr("data-id");$.tiziDialog({id:"deleteClassId",title:"解散班级",content:$("#deleteClassPop").html().replace("%classname%",classname).replace("deleteClassPopForm_beta","deleteClassPopForm"),icon:null,width:400,ok:function(){return $(".deleteClassPopForm").submit(),!1},cancel:!0}),classValid.deleteClass(class_id)}),$("#applyIn").live("click",function(){var teacher_subject=$("#teacher_subject").val(),realname=$("#realname").val(),class_id=$("#class_id").val();0==teacher_subject&&$.tiziDialog({content:"请选择学科."}),""==$.trim(realname)&&$.tiziDialog({content:"请输入您的真实姓名."}),teacher_subject>0&&""!==$.trim(realname)&&$.tizi_ajax({url:baseUrlName+"class/apply/dot",type:"POST",dataType:"json",data:{subject_id:teacher_subject,realname:realname,class_id:class_id},success:function(json){1==json.code?$.tiziDialog({content:json.msg,icon:"succeed",ok:function(){window.location.href=json.redirect}}):-999==json.code?showLogin.show_login():$.tiziDialog({content:json.msg})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})}),$(".iapp .ratify").live("click",function(){var node=$(this),apply_id=$(this).parent().parent().attr("data-id");$.tizi_ajax({url:baseUrlName+"class/apply/accept",type:"POST",dataType:"json",data:{apply_id:apply_id},success:function(json){1==json.code?$.tiziDialog({content:json.msg,icon:"succeed",ok:function(){node.parent().parent().remove()}}):-999==json.code?showLogin.show_login():$.tiziDialog({content:json.msg})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})}),$(".iapp .refuse").live("click",function(){var node=$(this),apply_id=node.parent().parent().attr("data-id");$.tizi_ajax({url:baseUrlName+"class/apply/refuse",type:"POST",dataType:"json",data:{apply_id:apply_id},success:function(json){1==json.code?$.tiziDialog({content:json.msg,icon:"succeed",ok:function(){node.parent().parent().remove()}}):-999==json.code?showLogin.show_login():$.tiziDialog({content:json.msg})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})}),$("#alterClassGrade").live("click",function(){var c=$("#ClassGrade").text();$.tiziDialog({id:"alterClassGradeId",title:"修改班级名称",content:$("#alterClassGradePop").html().replace("alterClassGradePopForm_beta","alterClassGradePopForm"),icon:null,width:400,ok:function(){$(".alterClassGradePopForm").submit()},cancel:!0}),$(".newClassGrade").val(c),classValid.alterClassGrade()}),$(".province li").live("click",function(){var _cityName=2==$(this).attr("data-id")||25==$(this).attr("data-id")||27==$(this).attr("data-id")||32==$(this).attr("data-id")||33==$(this).attr("data-id")||34==$(this).attr("data-id")||35==$(this).attr("data-id");if(_cityName?$(".city,.sctype,.school").hide():$(".county,.school").hide(),"active"!==$(this).attr("class")){var id=$(this).attr("data-id"),ismunicipality=$(this).attr("ismunicipality");$.ajax({url:baseUrlName+"class/area?id="+id,type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";1==ismunicipality?($(".county").html(listr),$(".county").fadeIn()):($(".city").html(listr),$(".city").fadeIn())}})}}),$(".city li").live("click",function(){if("active"!==$(this).attr("class")){var id=$(this).attr("data-id");$.ajax({url:baseUrlName+"class/area?id="+id,type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".county").html(listr),$(".county").css("display","block")}})}}),$(".county li").live("click",function(){$.ajax({url:baseUrlName+"class/area/sctype",type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".sctype").html(listr),$(".sctype").fadeIn()}})}),$(".sctype li").live("click",function(){if("active"!==$(this).attr("class")){var sctype=$(this).attr("data-id"),county_id=$(".aui_content .county li.active").attr("data-id");$.ajax({url:baseUrlName+"class/schools?id="+county_id+"&sctype="+sctype,type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].schoolname+"</li>";$(".school").html(listr),$(".school").css("display","block")}})}}),$(".schooLocation li").live("click",function(){$(this).addClass("active").siblings().removeClass("active")}),$("#resetSchool").live("click",function(){$.ajax({url:baseUrlName+"class/area?id=1",type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'" ismunicipality="'+json[i].ismunicipality+'">'+json[i].name+"</li>";$(".province").html(listr),$(".province").fadeIn()}}),$.tiziDialog({title:"选择学校",top:100,content:$("#resetSchoolPop").html().replace("resetSchoolPopCon_beta","resetSchoolPopCon"),icon:null,width:800,ok:function(){if(!($(".school li.active").length<1)){var school_id=$(".aui_content .school li.active").attr("data-id"),fullname="",province=$(".schoolProvice li.active").html(),city=$(".schoolCity li.active").html(),county=$(".schoolCounty li.active").html(),schoolname=$(".schoolName li.active").html();"undefined"==typeof city&&(city=""),fullname=province+city+county+schoolname,$("#schoolVal").val(school_id),$("#school").html(fullname)}},cancel:!0,close:function(){$(".city,.county,.sctype,.school").hide()}})}),$("#resetSchoolYear").live("click",function(){$.tiziDialog({title:"选择年份",content:$("#resetSchoolYearPop").html(),icon:null,width:400,ok:function(){var year=$("#set_year").val(),class_id=$("#set_year").attr("classid");$("#class_year").html()==year?$.tiziDialog({content:"班级入学年份修改成功.",icon:"succeed"}):$.tizi_ajax({url:baseUrlName+"class/update_info/year",type:"POST",dataType:"json",data:{year:year,class_id:class_id},success:function(json){1==json.code?$.tiziDialog({content:json.msg,icon:"succeed",ok:function(){$("#class_year").html(year)}}):-999==json.code?showLogin.show_login():$.tiziDialog({content:json.msg})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})},cancel:!0})}),$(".rms").live("click",function(){var node=$(this),name=$(this).attr("name"),csid=$(this).attr("csid");$.tiziDialog({title:"请离本班",content:$("#kickonePop").html().replace("%role%","学生").replace("%name%",name),icon:null,width:400,ok:function(){$.tizi_ajax({url:baseUrlName+"class/remove/student",type:"POST",dataType:"json",data:{csid:csid},success:function(json){1==json.code?$.tiziDialog({content:json.msg,icon:"succeed",ok:function(){node.parent().parent().css("display","none");var student_total=$("#student_total").html();$("#student_total").html(student_total-1)}}):-999==json.code?showLogin.show_login():$.tiziDialog({content:json.msg})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})},cancel:!0})}),$(".kickout").live("click",function(){var node=$(this),name=$(this).attr("name"),ctid=$(this).attr("ctid");$.tiziDialog({title:"请离本班",content:$("#kickonePop").html().replace("%role%","老师").replace("%name%",name),icon:null,width:400,ok:function(){$.tizi_ajax({url:baseUrlName+"class/remove/teacher",type:"POST",dataType:"json",data:{ctid:ctid},success:function(json){1==json.code?$.tiziDialog({content:json.msg,icon:"succeed",ok:function(){node.parent().parent().css("display","none");var teacher_total=$("#teacher_total").html();$("#teacher_total").html(teacher_total-1)}}):-999==json.code?showLogin.show_login():$.tiziDialog({content:json.msg})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})},cancel:!0})}),$(".reset_password").live("click",function(){{var student_name=$(this).attr("name"),uesr_id=$(this).attr("uid"),class_id=$("#class_id").val();$(this)}$.tiziDialog({title:"重置密码",content:$("#resetPasswordPop").html().replace("%name%",student_name),icon:null,width:400,ok:function(){$.tizi_ajax({url:baseUrlName+"class/update_info/reset_password",type:"POST",dataType:"json",data:{user_id:uesr_id,class_id:class_id},success:function(json){1==json.code?$.tiziDialog({content:json.msg,icon:"succeed",ok:function(){$("#pwd_"+uesr_id).html(json.password)}}):-999==json.code?showLogin.show_login():$.tiziDialog({content:json.msg})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})},cancel:!0})}),$(".rmcreate").live("click",function(){var sid=$(this).attr("sid"),node=$(this);$.tiziDialog({title:"删除帐号",content:"是否删除该帐号?",icon:"question",width:400,ok:function(){$.tizi_ajax({url:baseUrlName+"class/create_students/remove",type:"POST",dataType:"json",data:{sid:sid},success:function(json){1==json.code?$.tiziDialog({content:json.msg,icon:"succeed",ok:function(){node.parent().parent().remove();var student_total=$("#student_total").html();$("#student_total").html(student_total-1)}}):-999==json.code?showLogin.show_login():$.tiziDialog({content:json.msg})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})},cancel:!0})})},exports.classManageTab=function(){$(".class_manage_btn li").click(function(){$(this).addClass("active").siblings().removeClass("active");var _index=$(".class_manage_btn li").index(this);$(".class_manage_con .cont").eq(_index).show().siblings().hide()})},exports.claSharePop=function(){$(".shareFile").live("click",function(){var tit=$(this).text(),filetype=($(this),$(this).attr("filetype"));$("#fromInterPop").attr("chosen-type",filetype),$(".upBtn").show(),$(".upList").hide(),$.tiziDialog({title:tit,content:$("#sharePop").html().replace("share_field_beta","sharefield"),icon:null,width:600,init:function(){var allowType="";switch(filetype){case"1":allowType="*.doc;*.docx;*.ppt;*.pptx;*.xls;*.xlsx;*.wps;*.et;*.dps;*.pdf;*.txt;";break;case"2":allowType="*.jpg;*.png;*.gif;*.bmp;";break;case"3":allowType="*.rmvb;*.rm;*.flv;*.f4v;*.mp4;*.wmv;*.avi;*.mpeg;";break;case"4":allowType="*.mp3;*.wav;*.ape;";break;case"5":allowType="*.*"}sharefieldFn(this,allowType)},ok:function(){var class_id=$(".del_share_class_id").val(),file_id=$(".upList").attr("file_id"),desc=$("textarea").val();return $(".upList").length>1?($.tizi_ajax({url:baseUrlName+"teacher/cloud/share",type:"POST",dataType:"json",data:{"class":class_id,file_id:file_id,desc:desc},success:function(json){1==json.errorcode&&($.tiziDialog({content:json.error}),window.location.reload())},error:function(){$.tiziDialog({content:"服务器繁忙，请稍候再试"})}}),void 0):($.tiziDialog({content:"请选择一个文件"}),!1)},cancel:!0,close:function(){$("#sharefield").uploadify("destroy")}})})},exports.shareCancleFn=function(){$(".shareCancle").live("click",function(){var that=$(this),file_id=$(this).attr("file_id"),share_id=$(this).attr("share_id"),page=$("#current_page").val();$.tiziDialog({title:"取消分享",content:"确定取消分享吗？",icon:"question",width:400,ok:function(){$.tizi_ajax({url:baseUrlName+"teacher/cloud/del_share",type:"POST",dataType:"json",data:{share_id:share_id,file_id:file_id},success:function(json){1==json.errorcode?(that.parents(".shareBox").remove(),$.tiziDialog({content:json.error,icon:"succeed",ok:function(){}}),class_share_pagination(page)):$.tiziDialog({content:json.error})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})},cancel:!0,close:function(){}})})};var class_share_pagination=function(page){(new Date).valueOf();$.tizi_ajax({url:baseUrlName+"class/details/page",type:"GET",dataType:"json",data:{page:page,class_id:$(".del_share_class_id").val()},success:function(data){1==data.errorcode?$(".classTableHeight2").html(data.html):$.tiziDialog({content:"系统忙，请稍后再试"})},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}})};exports.class_share_pagination=function(page){class_share_pagination(page)};var sharefieldFn=function(ele,alType){seajs.use(["flashUploader","cookies"],function(){var uploadShareDialog,flag=!1,docExt="*.doc;*.docx;*.ppt;*.pptx;*.xls;*.xlsx;*.wps;*.et;*.dps;*.pdf;*.txt;",queueJsonStr="";$("#sharefield").uploadify({swf:staticBaseUrlName+staticVersion+"lib/uploadify/2.2/uploadify.swf",uploader:"http://up.qiniu.com",buttonClass:"choseFileBtn",button_image_url:staticBaseUrlName,buttonText:"从本地上传",fileTypeExts:alType,fileSizeLimit:"200MB",fileObjName:"file",multi:!1,width:106,height:35,preventCaching:!0,successTimeout:3600,uploadLimit:1,overrideEvents:["onSelectError","onUploadProgress","onCancel","onUploadSuccess"],onSWFReady:function(){},onSelect:function(file){$("#sharefield-queue").hide();var praseName=file.name;praseName.length>24&&(praseName=praseName.substring(0,24)+"...");var praseSize=praseFileSize(file.size);queueJsonStr+='{"queue_id":'+file.index+',"file_id":"'+file.id+'","file_name":"'+praseName+'","size":"'+praseSize+'","status":'+file.filestatus+"}"},onFallback:function(){$(".choseFile").html(noflash)},onSelectError:function(file,errorCode){switch(errorCode){case-100:$(".choseFile").find(".error").remove(),$.tiziDialog({content:"每次只能上传并分享1个文档"});break;case-110:$(".choseFile").find(".error").remove(),$.tiziDialog({content:"文件 ["+file.name+"] 过大！每份文档不能超过200M"});break;case-120:$(".choseFile").find(".error").remove(),$.tiziDialog({content:"文件 ["+file.name+"] 大小异常！不可以上传大小为0的文件"});break;case-130:$(".choseFile").find(".error").remove(),$.tiziDialog({content:"文件 ["+file.name+"] 类型不正确！不可以上传错误的文件格式"})}return!1},onUploadStart:function(file){if(-1!=docExt.indexOf(file.type)){var formData=$.tizi_token({session_id:$.cookies.get(baseSessID)},"post");$("#sharefield").uploadify("settings","formData",formData),$("#sharefield").uploadify("settings","uploader",baseUrlName+"upload/cloud"),$("#sharefield").uploadify("settings","fileObjName","shareFileUp")}else{var oldFileName=file.name,fileSize=file.size,fileKey="",fileToken="";$.tizi_ajax({url:baseUrlName+"cloud/cloud/ajax_get_token_key",type:"POST",dataType:"json",data:{file_ext:file.type,file_size:file.size},async:!1,success:function(data){return 1!=data.error_code?($.tiziDialog({content:data.error}),!1):(fileKey=data.file_key,fileToken=data.file_token,void 0)},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}});var formData={token:fileToken,key:fileKey,old_name:oldFileName,file_size:fileSize};$("#sharefield").uploadify("settings","formData",formData)}if(0==flag){queueJsonStr='{"files":['+queueJsonStr+"]}";var myobj=JSON.parse(queueJsonStr),listTemp=$("#fromLocalPop").html(),alertContent=Mustache.to_html(listTemp,myobj);uploadShareDialog=$.tiziDialog({id:"",title:"分享文档",content:alertContent,icon:null,width:600,ok:function(){var class_id=$(".del_share_class_id").val(),file_id=$(".upList").attr("file_id"),desc=$("textarea").val();""!==file_id?$.tizi_ajax({url:baseUrlName+"teacher/cloud/share",type:"POST",dataType:"json",data:{"class":class_id,file_id:file_id,desc:desc},success:function(json){1==json.errorcode&&($.tiziDialog({content:json.error}),window.location.reload())},error:function(){$.tiziDialog({content:"服务器繁忙，请稍候再试"})}}):$.tiziDialog({content:"您没有要分享的文件"})},cancel:!0}),flag=!0}},onUploadProgress:function(file,bytesUploaded,bytesTotal){var cFileIndex=file.index,cFileObj=$("#file_num_"+cFileIndex);if(bytesUploaded>0&&bytesTotal>bytesUploaded){var percentage=bytesUploaded/bytesTotal*100;percentage=percentage.toFixed(1),95>percentage&&(cFileObj.find("strong").css({width:percentage+"%"}),cFileObj.find(".status").html(percentage+"%"),cFileObj.find(".UploadCancel").html("删除"))}bytesUploaded==bytesTotal&&cFileObj.find(".UploadCancel").remove()},onCancel:function(file){queueJsonStr="";var cFileIndex=file.index,cFileObj=$("#file_num_"+cFileIndex);cFileObj.remove(),uploadShareDialog.close()},onUploadSuccess:function(file,data){queueJsonStr="";var cFileIndex=file.index,cFileObj=$("#file_num_"+cFileIndex),json=JSON.parse(data);json.key?$.tizi_ajax({url:baseUrlName+"cloud/cloud/qiniu_upload",type:"POST",dataType:"json",data:{key:json.key,file_name:file.name,file_size:file.size},success:function(data){1==data.error_code?(ele.close(),cFileObj.find(".status").remove(),cFileObj.find("strong").css({width:"100%"}),data.new_file_id&&$(".upList").attr("file_id",data.new_file_id)):(cFileObj.find(".status").css("color","red"),cFileObj.find(".status").html(data.error))},error:function(){$.tiziDialog({content:"系统忙，请稍后再试"})}}):json.code?1==json.code?(ele.close(),cFileObj.find(".status").remove(),cFileObj.find("strong").css({width:"100%"}),json.new_file_id&&$(".upList").attr("file_id",json.new_file_id)):-6==json.code?$.tiziDialog({content:json.msg,time:3}):(cFileObj.find(".status").css("color","red"),cFileObj.find(".status").html(json.msg)):(cFileObj.find(".status").css("color","red"),cFileObj.find(".status").html("上传失败"))},onUploadError:function(file,errorCode,errorMsg,errorString){uploadError(file,errorCode,errorMsg,errorString,"share_upload")},onQueueComplete:function(){queueJsonStr="",flag=!1}}),$("#sharefield").children().css({left:"0px"})})},uploadError=function(file,errorCode,errorMsg,errorString,source){$.tizi_ajax({url:baseUrlName+"cloud/cloud/upload_error",type:"POST",dataType:"json",data:{file_index:file.index,file_name:file.name,errorCode:errorCode,errorMsg:errorMsg,errorString:errorString,source:source},success:function(){}})},praseFileSize=function(size){for(var mod=1024,units=["B","KB","MB"],i=0;size>mod;i++)size/=mod;return size.toFixed(2)+" "+units[i]};exports.fromInterUpFn=function(){$("#fromInterUp").live("click",function(){var table="<table><tr><th class='b_r'>文件名</th><th>大小</th></tr></table>";$(".DisRight").html(table),$(".tree-title").each(function(){0==$(this).attr("dir-id")&&($(".folderList").eq(0).show(),$(this).addClass("tree-title-add"))}),get_file_in_a_dir(0),$.tiziDialog({title:"从网盘上传",content:$("#fromInterPop").html(),icon:null,width:600,ok:function(){var fid=$("input:radio:checked").attr("id"),fn=$("input:radio:checked").attr("file_name"),fs=$("input:radio:checked").attr("file_size");if(!fid)return $.tiziDialog({content:"请选择一个文件"}),!1;var _html="<ul class='upList' file_id='"+fid+"'><li class='cf'><span class='fl'>"+fn+"</span><span class='size fr'>"+fs+"</span></li></ul>";$(".upStyle").append(_html),$(".upBtn").hide()},cancel:!0})})};var get_file_in_a_dir=function(dirid){var filetype=$("#fromInterPop").attr("chosen-type");$.tizi_ajax({url:baseUrlName+"teacher/cloud/get_files_render",type:"GET",dataType:"json",data:{dir_id:dirid,filetype:filetype},success:function(json){1==json.errorcode&&$(".DisRight").html(json.html)},error:function(){$.tiziDialog({content:"服务器繁忙，请稍候再试"})}})};exports.moveFileFn=function(){$(".tree-title").live("click",function(){{var _nxt=$(this).next("ul"),_chd1=$(this).children("a").eq(0),_chd2=$(this).children("a").eq(1);$(this)}if($(".tree-title").removeClass("tree-title-add"),$(this).addClass("tree-title-add"),$(".shareItem").removeClass("unfold"),_nxt.length>0&&"block"==_nxt.css("display")?(_nxt.hide(),_chd1.removeClass("icon-plus").addClass("icon-add"),_chd2.removeClass("unfold").addClass("fold")):(_nxt.show(),_chd2.addClass("unfold"),$(this).find(".icon").hasClass("icon-add")?_chd1.removeClass("icon-add").addClass("icon-plus"):_chd1.removeClass("icon-add").removeClass("icon-plus")),$(".class_share_choose_file").val()){var dirid=$(this).attr("dir-id");get_file_in_a_dir(dirid)}})},exports.ZeroClipboard=function(){seajs.use("zeroClipboard",function(){ZeroClipboard.setMoviePath(staticBaseUrlName+staticVersion+"lib/ZeroClipboard/1.0.7/ZeroClipboard.1.0.7");var clip=new ZeroClipboard.Client;clip.setHandCursor(!0),clip.setText($("#inviteCode").text()),clip.glue("inviteId"),clip.addEventListener("complete",function(){$.tiziDialog({id:"copyClipID",content:"复制成功啦！赶快发送给你身边的老师或学生吧：）",icon:"succeed"})})})},exports.addStudent=function(){$("#create_student_menu").live("click",function(){var imaxc=$("#icmaxc").text()-$("#student_total").text();$("#ichas").html($("#student_total").text());var imaxc=($.tiziDialog({id:"uploadStudentList",title:"添加学生账号",content:$("#createStudentBillPop").html().replace("fileField_beta","fileField"),icon:null,width:600,cancel:!0,close:function(){$("#fileField").uploadify("destroy"),$(".choseFile .error").remove()},ok:function(){if($("#createStudent_name").is(":visible")){var text=$("#student_names_new");if(""==$.trim(text.val()))return text.next(".ValidformInfo").show(),!1;$.tizi_ajax({url:baseUrlName+"class/create_students/b_name",type:"POST",dataType:"json",data:{class_id:$("#class_id").val(),student_names:text.val()},success:function(data){classAjax.createStudent(data)}}),classValid.createStudent_new(class_id)}if($("#createStudent_noName").is(":visible")){var create_number=$("#J_Amount").val();parseInt(create_number)>0&&$.tizi_ajax({url:baseUrlName+"class/create_students/b_number",type:"POST",dataType:"json",data:{class_id:$("#class_id").val(),create_number:create_number},success:function(data){classAjax.createStudent(data)}})}if($("#createStudent_bills").is(":visible"),$("#createStudent_account").is(":visible")){var s=$(".stuAccName");if(""==s.val())return s.next(".ValidformInfo").show(),!1;var student_versign=$(".stuAccName").val();$.tizi_ajax({url:baseUrlName+"class/invite/t_invite_s",type:"POST",dataType:"json",data:{class_id:$("#class_id").val(),versign:student_versign},success:function(data){classAjax.teacherInputStudent(data)}})}}}),$("#icmaxc").text()-$("#student_total").text());imaxc>60&&(imaxc=60),$("#J_Amount").val(imaxc),xls_student(),tabContral.Tab(".creatStuNav","active",".tabBox")})};var xls_student=function(){seajs.use(["flashUploader","cookies"],function(){var class_id=$("#class_id").val(),flag=!1,msg="";$("#fileField").uploadify({formData:$.tizi_token({class_id:class_id,session_id:$.cookies.get(baseSessID)},"post"),swf:staticBaseUrlName+staticVersion+"lib/uploadify/2.2/uploadify.swf",uploader:baseUrlName+"upload/csxls?class_id="+class_id,buttonClass:"choseFileBtn",button_image_url:!1,buttonText:"上传名单",fileTypeExts:"*.xls; *.xlsx;",fileSizeLimit:"20MB",fileObjName:"fileField",multi:!1,width:90,height:28,uploadLimit:2,overrideEvents:["onSelectError","onDialogClose"],onSWFReady:function(){},onFallback:function(){$(".choseFile").html(noflash)},onSelectError:function(file,errorCode){switch(errorCode){case-100:$(".choseFile").find(".error").remove(),$.tiziDialog({content:"每次最多上传5份文档"});break;case-110:$(".choseFile").find(".error").remove(),$.tiziDialog({content:"文件 ["+file.name+"] 过大！每份文档不能超过20M"});break;case-120:$(".choseFile").find(".error").remove(),$.tiziDialog({content:"文件 ["+file.name+"] 大小异常！不可以上传大小为0的文件"});break;case-130:$(".choseFile").find(".error").remove(),$.tiziDialog({content:"文件 ["+file.name+"] 类型不正确！不可以上传错误的文件格式"})}return!1},onUploadSuccess:function(file,data){var json=JSON.parse(data);if($("#fileField").attr("disabled",!0),$(".aui_footer button").attr("disabled",!0),$(".choseFile").append('<img src="'+staticUrlName+'image/tizi_dialog/icon/loading.gif"/>'),1==json.code)student_prepare=json.data,$("#fileField").removeAttr("disabled"),$(".aui_footer button").removeAttr("disabled"),$(".choseFile").find("img").remove(),flag=!0,msg=json.msg;else{$(".aui_footer button").removeAttr("disabled"),$("#fileField").removeAttr("disabled"),$(".choseFile").find("img").remove(),$(".choseFile").find(".error").remove();var str1='<div class="error">'+file.name+json.msg+"</div>";$(".choseFile").append(str1)}},onUploadComplete:function(){flag&&($.tiziDialog.list.uploadStudentList.close(),$.tiziDialog({content:msg,icon:"succeed",ok:function(){window.location.reload()},close:function(){window.location.reload()}}))}}),$("#SWFUpload_0").css({left:"-13px"})})};exports.addPlus=function(){jQuery.extend({min:1,reg:function(x){return jQuery("#J_Tip").html(""),jQuery("#J_Tip").hide(),new RegExp("^[1-9]\\d*$").test(x)},amount:function(obj,mode){var x=jQuery(obj).val();return this.reg(parseInt(x))?mode?x++:x--:(jQuery("#J_Tip").show(),jQuery(obj).val(1),jQuery(obj).focus()),x},reduce:function(obj){var x=this.amount(obj,!1);if(parseInt(x)>=this.min)jQuery(obj).val(x);else{var max=parseInt(jQuery("#icmaxc").text())-parseInt(jQuery("#ichas").text());0==max?(jQuery("#J_Tip").html('<i class="ico"></i>最多还可添加'+max+"人!"),jQuery(obj).val(0)):(jQuery("#J_Tip").html('<i class="ico"></i>添加最少为'+this.min+"！"),jQuery(obj).val(1)),jQuery("#J_Tip").show(),jQuery(obj).focus()}},add:function(obj){var x=this.amount(obj,!0),max=parseInt(jQuery("#icmaxc").text())-parseInt(jQuery("#ichas").text());parseInt(x)<=parseInt(max)?(jQuery(obj).val(x),0==max&&(jQuery("#J_Tip").html('<i class="ico"></i>最多还可添加'+max+"人!"),jQuery("#J_Tip").show())):(jQuery("#J_Tip").html('<i class="ico"></i>最多还可添加'+max+"人!"),jQuery("#J_Tip").show(),jQuery(obj).val(0==max?0:max),jQuery(obj).focus())},modify:function(obj){var x=jQuery(obj).val(),max=parseInt(jQuery("#icmaxc").text())-parseInt(jQuery("#ichas").text());if(!this.reg(parseInt(x)))return 0==max?(jQuery("#J_Tip").html('<i class="ico"></i>最多还可添加'+max+"人!"),jQuery(obj).val(0),!1):(0==x&&(jQuery("#J_Tip").html('<i class="ico"></i>添加最少为'+this.min+"！"),jQuery(obj).val(1)),jQuery("#J_Tip").show(),jQuery(obj).focus(),void 0);var intx=parseInt(x),intmax=parseInt(max);intx<this.min?(jQuery("#J_Tip").html('<i class="ico"></i>添加最少为'+this.min+"！"),jQuery("#J_Tip").show(),jQuery(obj).val(this.min),jQuery(obj).focus()):intx>intmax&&(jQuery("#J_Tip").html('<i class="ico"></i>最多还可添加'+intmax+"人!"),jQuery("#J_Tip").show(),jQuery(obj).val(0==max?0:max),jQuery(obj).focus())}}),$(".num_min").live("click",function(){jQuery.reduce("#J_Amount")}),$(".num_plus").live("click",function(){jQuery.add("#J_Amount")})},exports.studentHomework=function(){$(".deleteDownHomework").live("click",function(){$(this).parents("tr").remove()}),$(".downloadNum").live("click",function(){$.tiziDialog({title:"查看作业下载名单",content:$("#downloadNumPop").html(),icon:null,width:600,ok:function(){}})})},exports.homeworkPreTab=function(){$(".homeworkPreTab li").click(function(){$(this).addClass("active").siblings().removeClass("active");var _index=$(".homeworkPreTab li").index(this);$(".homeworkPreCon .homeworkCont").eq(_index).show().siblings().hide()})},exports.subjectDetial=function(){$(".subjectDetial").live("click",function(){var tit=$(this).text();$.tiziDialog({title:tit,content:$("#subjectDetialPop").html(),icon:null,width:600,ok:function(){}})})},exports.comment=function(){$(".writeComment").live("click",function(){var t=$(this).text(),assignment_id=$(".assignment_id").val();seajs.use("tizi_ajax",function(){$.tizi_ajax({url:"/ep/ep/give_cmt_preview",type:"GET",data:{ass_id:assignment_id,ver:(new Date).valueOf()},dataType:"json",success:function(data){if(1==data.errorcode){for(var _content='<div class="teacherClass"><div class="pop_main"><div class="commentBpx"><div class="commentName fl"><div class="m_b_5">选择学生</div><ul>',i=0;i<data.stu.length;i++)_content+='<li><label for="'+data.stu[i].student_id+'">',_content+='<input type="checkbox" name="checkbox" id="'+data.stu[i].student_id+'" value="'+data.stu[i].student_id+'" />',_content+=data.stu[i].name+"</label></li>";_content+='</ul><div class="checkAll"><label for="checkAll"><input id="checkAll" type="checkbox" name="name" />全选</label></div></div><div class="commentDetial fl"><div class="m_b_5">评论内容</div><textarea class="cmt_content"></textarea></div></div></div></div>',$.tiziDialog({title:t,content:_content,icon:null,width:800,ok:function(){var chosen_student="";if($("input[name='checkbox']:checked").each(function(){chosen_student+=$(this).val()+","}),chosen_student.length<1)return $.tiziDialog({content:"请选择至少一个学生"}),!1;var _give_cmt=$(".cmt_content").val();return _give_cmt.replace(/(^\s*)|(\s*$)/g,"").length<1?($.tiziDialog({content:"评语内容不能为空"}),!1):($.tizi_ajax({url:"/ep/ep/insert_cmt",type:"POST",data:{stu_ids:chosen_student,ass_id:assignment_id,cmt:_give_cmt,ver:(new Date).valueOf()},dataType:"json",success:function(data){1==data?($.tiziDialog({content:"添加成功"}),location.reload()):$.tiziDialog({content:data.error})
}}),void 0)}}),checkAll()}else $.tiziDialog({content:data.error})}})})})};var checkAll=function(){$("#checkAll").live("click",function(){this.checked?$(".commentName input[name='checkbox']").each(function(){this.checked=!0}):$(".commentName input[name='checkbox']").each(function(){this.checked=!1})})}}),define("module/common/basics/teacherClass/classValid",["lib/tizi_common/0.0.1/tizi_datatype","module/common/ajax/teacherClass/classAjax","module/common/basics/common/showLogin","module/common/basics/common/md5","md5"],function(require,exports){var sDataType=require("lib/tizi_common/0.0.1/tizi_datatype").dataType(),classAjax=require("module/common/ajax/teacherClass/classAjax"),teacherMd5=require("module/common/basics/common/md5");exports.alterClassGrade=function(){var _Form=$(".alterClassGradePopForm").Validform({tiptype:3,showAllError:!1,ajaxPost:!0,beforeSubmit:function(){$(".classId").val($("#class_id").val())},callback:function(data){classAjax.alterClassGrade(data)}});_Form.addRule([{ele:".newClassGrade",datatype:"*1-50",nullmsg:"请输入文件夹名称",errormsg:"长度1-50字符之间"}])},exports.creat=function(){var _Form=$(".creatNewClassForm").Validform({tiptype:function(msg,o){if(!o.obj.is("form")){var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg),o.obj.next().show();var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg);var infoObj=o.obj.next(".ValidformInfo");2==o.type&&(infoObj.show(),o.obj.next().hide())}},showAllError:!1,ajaxPost:!0,callback:function(data){classAjax.common(data)}});_Form.addRule([{ele:"#set_year",datatype:"*",nullmsg:"请选择年份",errormsg:"选择错误！"},{ele:".classNameInput",datatype:"*1-12",nullmsg:"请输入班级名称",errormsg:"长度1-12字符之间"},{ele:"#teacher_subject",datatype:"*",nullmsg:"请选择授课科目",errormsg:"选择错误！"}])},exports.invite=function(){var _Form=$(".inVislbleClassForm").Validform({tiptype:function(msg,o){if(!o.obj.is("form")){var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg),o.obj.next().show();var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg);var infoObj=o.obj.next(".ValidformInfo");2==o.type&&(infoObj.show(),o.obj.next().hide())}},showAllError:!1,ajaxPost:!0,callback:function(data){classAjax.invite(data)}});_Form.addRule([{ele:".in_vislble_class_text",datatype:"*6-8",nullmsg:"请输入班级编号",errormsg:"长度6-8个字符"},{ele:"select",datatype:"*",nullmsg:"请选择授课科目",errormsg:"选择错误！"}])},exports.createStudent_new=function(){var _Form=$(".createStudentName").Validform({tiptype:function(msg,o){if(!o.obj.is("form")){var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg),o.obj.next().show();var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg);var infoObj=o.obj.next(".ValidformTips");2==o.type&&(infoObj.show(),o.obj.next().hide())}},showAllError:!1,ajaxPost:!0,beforeSubmit:function(curform){$(".classId").val($("#class_id").val()),teacherMd5.md5(curform)},callback:function(data){classAjax.createStudent(data)}});_Form.addRule([{ele:".studentNames_new",datatype:"*",nullmsg:"请输入姓名",errormsg:"至少需要输入一个姓名！"}])},exports.createStudentHasCount=function(){var _Form=$(".createStudentHasCount").Validform({tiptype:function(msg,o){if(!o.obj.is("form")){var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg),o.obj.next().show();var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg);var infoObj=o.obj.next(".ValidformTips");2==o.type&&(infoObj.show(),o.obj.next().hide())}},showAllError:!1,ajaxPost:!0,beforeSubmit:function(curform){$(".classId").val($("#class_id").val()),Common.comValidform.md5(curform)},callback:function(data){classAjax.createStudent(data)}});_Form.addRule([{ele:".stuAccName",datatype:"*",nullmsg:"请输入账号",errormsg:"请输入账号！"}])},exports.deleteClass=function(class_id){var _Form=$(".deleteClassPopForm").Validform({tiptype:3,showAllError:!1,ajaxPost:!0,beforeSubmit:function(curform){$(".classId").val(class_id),teacherMd5.md5(curform)},callback:function(data){classAjax.common(data)}});_Form.addRule([{ele:".in_vislble_class_text",datatype:sDataType.Passwd.datatype,nullmsg:sDataType.Passwd.nullmsg,errormsg:sDataType.Passwd.errormsg}])}}),define("module/common/ajax/teacherClass/classAjax",["module/common/basics/common/showLogin"],function(require,exports){var showLogin=require("module/common/basics/common/showLogin");exports.common=function(data){1==data.code?$.tiziDialog({content:data.msg,icon:"succeed",ok:function(){window.location.href=data.redirect}}):-999==data.code?showLogin.show_login():$.tiziDialog({content:data.msg})},exports.invite=function(data){1==data.code?window.location.href=data.redirect:-999==data.code?showLogin.show_login():$.tiziDialog({content:data.msg})},exports.deleteClass=function(data){1==data.code?($.tiziDialog.list.deleteClassId.close(),$.tiziDialog({content:data.msg,icon:"succeed",ok:function(){window.location.reload()}})):-999==data.code?showLogin.show_login():$.tiziDialog({content:data.msg})},exports.createStudent=function(data,type){if(1==data.code){var st=data.students;ga("send","event","CreateStudent-"+type,"CreateStudent",type,data.students.length),$.tiziDialog({content:data.msg+"<br />请将学号和密码告知您的学生，尽快登录。",icon:"succeed",ok:function(){for(var tr="",i=0;i<data.students.length;++i){var atr=$("#crtemplate").html();atr=atr.replace("%student_name%",st[i].student_name),atr=atr.replace("%student_id%",st[i].student_id),atr=atr.replace("%student_id%",st[i].student_id),atr=atr.replace("%password%",st[i].password),tr+=atr}$.browser.msie&&"7.0"==$.browser.version||$.browser.msie&&"6.0"==$.browser.version?($(".myallClass_student").append("<tr>"+tr+"</tr>"),$(".myallClass_student tr").each(function(){""==$(this).html()&&$(this).remove()})):$(".myallClass_student").append(tr);var student_total=parseInt($("#student_total").text());$("#student_total").text(student_total+data.students.length),$("#dlacc").css("display","inline-block"),$("#havestudentdiv").css("display","block"),$(".emptyNotice").css("display","none")}})}else-999==data.code?showLogin.show_login():$.tiziDialog({content:data.msg})},exports.teacherInputStudent=function(data){if(1==data.code){var st=data.students;$.tiziDialog({content:data.msg,icon:"succeed",ok:function(){for(var tr="",i=0;i<data.students.length;++i){var atr=$("#crtemplate").html();atr=atr.replace("%student_name%",st[i].student_name),atr=atr.replace("%student_id%",st[i].student_id),atr=atr.replace("%student_id%",st[i].student_id),atr=atr.replace("%password%",st[i].password),atr=atr.replace("学生还未激活帐号",st[i].lastactive),tr+=atr}$.browser.msie&&"7.0"==$.browser.version||$.browser.msie&&"6.0"==$.browser.version?($(".myallClass_student").append("<tr>"+tr+"</tr>"),$(".myallClass_student tr").each(function(){""==$(this).html()&&$(this).remove()})):$(".myallClass_student").append(tr);var student_total=parseInt($("#student_total").text());$("#student_total").text(student_total+data.students.length),1==data.code&&(window.location.href=window.location.href)}})}else-999==data.code?showLogin.show_login():$.tiziDialog({content:data.msg})},exports.alterClassGrade=function(data){1==data.code?$.tiziDialog({content:data.msg,icon:"succeed",ok:function(){var _name=data.name;$("#ClassGrade").text(_name),$("#lft_"+$("#class_id").val()).text(_name)}}):-999==data.code?showLogin.show_login():$.tiziDialog({content:data.msg})},exports.deleteClass=function(data){1==data.code?($.tiziDialog.list.deleteClassId.close(),$.tiziDialog({content:data.msg,icon:"succeed",ok:function(){window.location.reload()}})):-999==data.code?showLogin.show_login():$.tiziDialog({content:data.msg})},exports.acceptInvite=function(data){1==data.code?$.tiziDialog({content:data.msg,icon:"succeed",close:function(){window.location.href=data.redirect}}):$.tiziDialog({content:data.msg,close:function(){data.redirect&&(window.location.href=data.redirect)}})}}),define("module/common/method/common/tab",[],function(require,exports){exports.homePageTab=function(){$("#changeSubject a").live("click",function(){var obj=$(this),subject_type=obj.attr("sn"),area_id=$("#areaName").attr("area");$(this).addClass("active").siblings().removeClass("active"),$("#subjectName").attr("subject_type",obj.attr("sn")),$.tizi_ajax({url:baseUrlName+"paper/paper_exam/position?area_id="+area_id+"&stype_id="+subject_type,type:"GET",dataType:"json",success:function(data){$("#expos_list").html(data.html)}})})},exports.stuPraticeTab=function(clickObj,className,showObj){clickObj.click(function(){var index=clickObj.index($(this));clickObj!=$(".stuNav li")&&($(".courseNav li").removeClass("stuOn"),$(".exercises .practiceBox").removeClass("dis"),$(".courseNav:eq("+index+") li").eq(0).addClass("stuOn"),$(".exercises:eq("+index+") .practiceBox").eq(0).addClass("dis")),clickObj.removeClass(className),$(this).addClass(className),showObj.removeClass("dis"),showObj.eq(index).addClass("dis")})},exports.gradeTab=function(){var reg=new RegExp("^.*/([1-6]{1})"),key=window.location.href.match(reg);null!=key&&(index=key[1]-1,$(".stuNav").find("a").removeClass("active"),$(".stuNav").find("a:eq("+index+")").addClass("active"))},exports.subjectTab=function(){var reg=new RegExp("^.*#([1-9]{1})"),key=window.location.href.match(reg);null!=key&&(index=key[1],$(".courseNav").find(".s_"+index).click())},exports.Tab=function(tabTit,on,tabCon){$(tabCon).each(function(){$(this).children().eq(0).show().siblings().hide()}),$(tabTit).each(function(){$(this).children().eq(0).addClass(on)}),$(tabTit).children().click(function(){$(this).addClass(on).siblings().removeClass(on);var index=$(tabTit).children().index(this);$(tabCon).children().eq(index).show().siblings().hide()})},exports.homeworkTab=function(tabTit,on,tabCon){$(tabCon).each(function(){$(this).children().eq(0).show().siblings().hide()}),$(tabTit).each(function(){$(this).children().eq(0).addClass(on)}),$(tabTit).children().click(function(){$(this).addClass(on).siblings().removeClass(on);var index=$(tabTit).children().index(this);$(tabCon).children().eq(index).show().siblings().hide()})}});