define("module/teacherClass/downloadAssignment",["lib/tizi_ajax/0.0.1/tizi_ajax","lib/artDialog/4.1.7/artDialog","lib/tizi_common/0.0.1/tizi_download","cookies","tizi_ajax","tiziDialog"],function(require,exports){require("lib/tizi_ajax/0.0.1/tizi_ajax"),require("lib/artDialog/4.1.7/artDialog"),exports.homeworkDownload={downWord:$(".down-word-btn"),init:function(){var _this=this;$(".downhw").click(function(){_this._downhw($(this).attr("assid"),"student")}),$(".teacherdownhw").click(function(){_this._downhw($(this).attr("assid"),"teacher")})},_downhw:function(slid,role){if("disabled"==this.downWord.attr("disabled"))return!1;var _icon="",content="是否确定下载本次作业？",width=360;_icon="question",$.tiziDialog({title:"下载作业",content:content,icon:_icon,width:width,init:function(){$(".paperCaptchaWord").addClass("undis")},ok:function(){this_a=exports.homeworkDownload;var downWord=$("a[slid='"+slid+"'][class='down-word-btn']");downWord.html("下载中"),downWord.attr("disabled","disabled"),this_a.hw_download(slid,role,"homework",function(){this_a=exports.homeworkDownload,downWord.html("下载"),downWord.removeAttr("disabled")}),"student"==role&&$.tizi_ajax({url:baseUrlName+"student/task/download_hw_mark",type:"POST",data:{assid:slid},dataType:"json",success:function(data){return data.errorcode}})},cancel:!0})},hw_download:function(slid,role,download_type,unlock){var paper_version="docx",paper_type=role,post_data={paper_version:paper_version,paper_type:paper_type,save_log_id:slid,download_type:download_type,assid:slid},paper_size="A4";post_data.captcha_name="PaperDownBox",post_data.captcha_word=$(".PaperDownBoxWord").val(),post_data.paper_style="default",post_data.paper_size=paper_size,baseuri=baseUrlName+"paper/download/down_assignment",$.tizi_ajax({url:baseuri,type:"POST",data:post_data,dataType:"json",success:function(data){if(unlock(),0==data.errorcode)$.tiziDialog({content:data.error});else{var url=baseUrlName+"download/paper?url="+data.url+"&file_name="+data.file_name+"&download_type="+download_type;ga("send","event","Download-Paper-"+download_type,"Download",data.fname),require("lib/tizi_common/0.0.1/tizi_download").force_download(url,data.fname)}}})}}});